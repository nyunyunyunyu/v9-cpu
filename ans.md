## v9-cpu相关题目
---

### 提前准备
```
sudo apt-get install hexedit
cd YOUR v9-cpu DIR
git pull 
cd YOUR os_course_spoc_exercise DIR
git pull 
```

分析和实验funcall.c，需要完成的内容包括： 
-[X]

 - 修改代码，可正常显示小组两位同学的学号（用字符串） 
   - 
   v9-cpu/root/usr/funcall.c 24行
   ```
ret = write(1, "2013011316 2013011316", 21);
   ```
 - 生成funcall.c的汇编码，理解其实现并给汇编码写注释
   - 见funcall.txt文件。
 - 尝试用xem的简单调试功能单步调试代码
 - 回答如下问题：
   - funcall中的堆栈有多大？是内核态堆栈还是用户态堆栈
      - 刚运行时sp为0x7c00000 ,top sp为0x000be9cd，所以栈大小为两值相减为123.255MB。内核态。
   - funcall中的全局变量ret放在内存中何处？如何对它寻址？
      - 0xa8，通过读运行时0x18的内容确定。
   - funcall中的字符串放在内存中何处？如何对它寻址？
      - 放在代码之后，通过全局变量读写
   - 局部变量i在内存中的何处？如何对它寻址？
      - 存放在栈内，读00000020处的代码可以知道在sp+4的位置。
   - 当前系统是处于中断使能状态吗？
      - iena为0，使能失效
   - funcall中的函数参数是如何传递的？函数返回值是如何传递的？
      - 按从右到左的顺序压入栈中。返回值通过a寄存器返回。
   - 分析并说明funcall执行文件的格式和内容
      - 

分析和实验os0.c，需要完成的内容包括： 
-[X]

 - 生成os0.c的汇编码，理解其实现并给汇编码写注释
   - 见os0.txt文件
 - 尝试用xem的简单调试功能单步调试代码
 - 回答如下问题：
   - 何处设置的中断使能？
      - 通过调用STI命令
   - 系统何时处于中断屏蔽状态？
      - 程序进入直到调用STI命令。
   - 如果系统处于中断屏蔽状态，如何让其中断使能？
      - 调用STI命令
   - 系统产生中断后，CPU会做哪些事情？（在没有软件帮助的情况下）
      - 如果终端产生了键盘输入，且iean=1，则ipend |= FKEYBD，0-->iena
      - 如果timer产生了timeout，且iean=1，则ipend |= FTIMER，0-->iena
      - 如果产生了其他异常，则会有相应的处理，
      - 然后，保存中断的地址到kkernel mode的sp中，pc会跳到中断向量的地址ivec处执行
   - CPU执行RTI指令的具体完成工作是哪些？
      - 从中断中返回，重设pc和sp，并按需切换用户态和核心态。若还有等待的中断，则执行该中断。

[HARD]分析和实验os1/os3.c，需要完成的内容包括： 
-[X]
 
 - os1中的task1和task2的堆栈的起始和终止地址是什么？
   - 
 - os1是如何实现任务切换的？
 - os3中的task1和task2的堆栈的起始和终止地址是什么？
 - os3是如何实现任务切换的？
 - os3的用户态task能够破坏内核态的系统吗？